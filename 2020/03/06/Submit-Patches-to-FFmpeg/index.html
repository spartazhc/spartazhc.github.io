<!-- build time:Sun Aug 23 2020 20:11:00 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|EB Garamond:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"spartazhc.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="想参加今年的GSoC 2020的一个FFmpeg project，需要先做一个Qualification Task: Fix any open bug(s) on trac, get your patch reviewed on ffmpeg-devel@ mailing list. 花了几天解决了一个bug，没几行代码（我太慢了太菜了），然后在提交patch的时候碰到了不少问题。基本上，hwre"><meta property="og:type" content="article"><meta property="og:title" content="Submit Patches to FFmpeg"><meta property="og:url" content="https://spartazhc.github.io/2020/03/06/Submit-Patches-to-FFmpeg/index.html"><meta property="og:site_name" content="spartazhc&#39;s blog"><meta property="og:description" content="想参加今年的GSoC 2020的一个FFmpeg project，需要先做一个Qualification Task: Fix any open bug(s) on trac, get your patch reviewed on ffmpeg-devel@ mailing list. 花了几天解决了一个bug，没几行代码（我太慢了太菜了），然后在提交patch的时候碰到了不少问题。基本上，hwre"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-03-05T17:42:26.000Z"><meta property="article:modified_time" content="2020-03-05T17:42:26.000Z"><meta property="article:author" content="spartazhc"><meta property="article:tag" content="linux"><meta property="article:tag" content="tools"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://spartazhc.github.io/2020/03/06/Submit-Patches-to-FFmpeg/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Submit Patches to FFmpeg | spartazhc's blog</title><script>function sendPageView(){if(CONFIG.hostname===location.hostname){var e=localStorage.getItem("uid")||Math.random()+"."+Math.random();localStorage.setItem("uid",e),navigator.sendBeacon("https://www.google-analytics.com/collect",new URLSearchParams({v:1,tid:"UA-168851576-1",cid:e,t:"pageview",dp:encodeURIComponent(location.pathname)}))}}document.addEventListener("pjax:complete",sendPageView),sendPageView()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="spartazhc's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">spartazhc's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/spartazhc" class="github-corner" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://spartazhc.github.io/2020/03/06/Submit-Patches-to-FFmpeg/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="spartazhc"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="spartazhc's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Submit Patches to FFmpeg</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-03-06 01:42:26" itemprop="dateCreated datePublished" datetime="2020-03-06T01:42:26+08:00">2020-03-06</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a> </span></span><span id="/2020/03/06/Submit-Patches-to-FFmpeg/" class="post-meta-item leancloud_visitors" data-flag-title="Submit Patches to FFmpeg" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/03/06/Submit-Patches-to-FFmpeg/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/03/06/Submit-Patches-to-FFmpeg/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>6.9k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>6 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><div class="note default"><p>想参加今年的GSoC 2020的一个FFmpeg project，需要先做一个Qualification Task: Fix any open bug(s) on trac, get your patch reviewed on ffmpeg-devel@ mailing list. 花了几天解决了一个bug，没几行代码（我太慢了太菜了），然后在提交patch的时候碰到了不少问题。基本上，hwren的博客<a href="https://www.jianshu.com/p/1f54b144bd5b" target="_blank" rel="noopener">FFmpeg - 修改提交流程</a>里面都讲到了，但实际操作中，我还是碰到了一些问题，主要困难在于最后一步<code>git send-email</code>尝试了很久才成功，另外，邮件列表回复格式也折腾了我好久。</p><p>本文包含：1. 如何提交patch; 2. <code>git send-email</code>配置; 3. 邮件列表回复格式; 4. 一些经验教训</p></div><a id="more"></a><h2 id="Check-List"><a href="#Check-List" class="headerlink" title="Check List"></a>Check List</h2><ol><li>准备好patch</li><li>FATE测试：<code>make fate -j8</code></li><li>提交修改：<code>git commit -s</code>，<code>-s</code>表示签名</li><li>生成patch：<code>git format-patch -v[x] -[n]</code>，<code>-v[x]</code>是版本，<code>-[n]</code>是打包commit的数量</li><li>检查patch：使用工具<code>tools/pacheck</code>检查<code>patch</code>规范，按提示进行修改</li><li>按照官方<code>check list</code>进行检查：<a href="https://ffmpeg.org/developer.html#toc-Patch-submission-checklist" target="_blank" rel="noopener">Patch submission checklist</a></li><li>提交patch：<code>git send-email -to ffmpeg-devel@ffmpeg.org 0001-xxxxx.patch</code></li><li>检查邮件和<a href="https://patchwork.ffmpeg.org/project/ffmpeg/list/" target="_blank" rel="noopener">https://patchwork.ffmpeg.org/project/ffmpeg/list/</a>，应该可以看到新发的patch</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example: git commit</span></span><br><span class="line">commit e27a35e0458224ef6f47753f248ba84ec8284818</span><br><span class="line">Author: Jun Zhao &lt;barryjzhao@tencent.com&gt;</span><br><span class="line">Date:   Wed Feb 19 11:51:20 2020 +0800</span><br><span class="line"></span><br><span class="line">    lavf/dashdec: add 3GPP TS26.247 probe <span class="keyword">in</span> dash demuxer</span><br><span class="line">    </span><br><span class="line">    Enabled the 3GP-DASH Release-10/Relase-11(3GPP TS26.247) profile</span><br><span class="line">    to dash demuxer probe.</span><br><span class="line">    </span><br><span class="line">    Signed-off-by: Jun Zhao &lt;barryjzhao@tencent.com&gt;</span><br></pre></td></tr></table></figure><h2 id="git-send-email-configuration"><a href="#git-send-email-configuration" class="headerlink" title="git send-email configuration"></a>git send-email configuration</h2><h3 id="default-way"><a href="#default-way" class="headerlink" title="default way"></a>default way</h3><h4 id="1-安装软件"><a href="#1-安装软件" class="headerlink" title="1. 安装软件"></a>1. 安装软件</h4><ul><li>发现默认不带git-email，首先安装git-email</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> apt install git-email</span><br></pre></td></tr></table></figure><h4 id="2-配置smtp"><a href="#2-配置smtp" class="headerlink" title="2. 配置smtp"></a>2. 配置smtp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> ~/.gitconfig</span><br><span class="line"><span class="comment"># add this</span></span><br><span class="line">[sendemail]</span><br><span class="line">    from = Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">    smtpencryption = tls</span><br><span class="line">    smtpserver = smtp.sjtu.edu.cn</span><br><span class="line">    smtpserverport = 587</span><br><span class="line">    smtpuser = sj.hc_Zhong@sjtu.edu.cn</span><br><span class="line">    smtppass = mypasswd</span><br><span class="line">    suppresscc = self</span><br><span class="line">    chainreplyto = <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="3-生成patch"><a href="#3-生成patch" class="headerlink" title="3. 生成patch"></a>3. 生成patch</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git format-patch -n[x] -v[x] -o xxx/</span><br><span class="line"><span class="comment"># 常用的参数</span></span><br><span class="line"><span class="comment"># -n[x] 涉及几个commit，效果[PATCH n/m]</span></span><br><span class="line"><span class="comment"># -v[x] 第几个版本，效果[PATCH v4 1/20]</span></span><br><span class="line"><span class="comment"># -o 指定输出的文件夹</span></span><br><span class="line"><span class="comment"># --subject-prefix=&lt;subject prefix&gt; 可以改掉[PATCH]的效果，我用来加GSoC</span></span><br><span class="line"><span class="comment"># --subject-prefix="PATCH] [GSoC"，但是这样的效果是[PATCH] [GSoC 1/6] 不是完美的</span></span><br></pre></td></tr></table></figure><h4 id="4-发送patch"><a href="#4-发送patch" class="headerlink" title="4. 发送patch"></a>4. 发送patch</h4><ul><li>可以先发给自己试一试</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git send-email -to sj.hc_Zhong@sjtu.edu.cn 0001-avformat-hlsenc-Fix-initial-setting-for-start_pts.patch  </span><br><span class="line">0001-avformat-hlsenc-Fix-initial-setting-for-start_pts.patch</span><br><span class="line">OK. Log says:</span><br><span class="line">Server: smtp.sjtu.edu.cn</span><br><span class="line">MAIL FROM:&lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">RCPT TO:&lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">From: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">To: sj.hc_Zhong@sjtu.edu.cn</span><br><span class="line">Subject: [PATCH] avformat/hlsenc: Fix initial setting <span class="keyword">for</span> start_pts</span><br><span class="line">Date: Thu,  5 Mar 2020 21:53:48 +0800</span><br><span class="line">Message-Id: &lt;1583416428-7444-1-git-send-email-sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">X-Mailer: git-send-email 2.7.4</span><br><span class="line"></span><br><span class="line">Result: 250</span><br></pre></td></tr></table></figure><h3 id="use-msmtp-proxychain"><a href="#use-msmtp-proxychain" class="headerlink" title="use msmtp + proxychain"></a>use msmtp + proxychain</h3><ul><li>参考：<a href="https://www.smitechow.com/2018/10/git-send-email-use-proxy.html" target="_blank" rel="noopener">git send-email use proxy (msmtp + proxychains)</a>，这么做的原因是</li></ul><blockquote><p><code>git send-email</code> not work with normal git proxy config, <code>proxychains</code> is a general proxy for Linux normal shell command, but not work with <code>git send-email</code>.</p><p>So, basic we need tell <code>send-email</code> use another smtp client <code>msmtp</code> which compatible <code>proxychains</code>.</p></blockquote><h4 id="1-安装软件-1"><a href="#1-安装软件-1" class="headerlink" title="1. 安装软件"></a>1. 安装软件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> apt install msmtp proxychain</span><br></pre></td></tr></table></figure><h4 id="2-修改配置文件x3"><a href="#2-修改配置文件x3" class="headerlink" title="2. 修改配置文件x3"></a>2. 修改配置文件x3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> ~/.msmtprc</span><br><span class="line"><span class="comment"># Example for a user configuration file</span></span><br><span class="line"><span class="comment"># Set default values for all following accounts.</span></span><br><span class="line">defaults</span><br><span class="line">auth on</span><br><span class="line">tls on</span><br><span class="line">tls_trust_file /etc/ssl/certs/ca-certificates.crt</span><br><span class="line">logfile ~/.msmtp.log</span><br><span class="line"><span class="comment"># My email service</span></span><br><span class="line">account sjtu</span><br><span class="line">host smtp.sjtu.edu.cn</span><br><span class="line">port 587</span><br><span class="line"><span class="comment"># proxy here is useless</span></span><br><span class="line"><span class="comment"># proxy_host 127.0.0.1</span></span><br><span class="line"><span class="comment"># proxy_port 7890</span></span><br><span class="line">from sj.hc_Zhong@sjtu.edu.cn</span><br><span class="line">user sj.hc_Zhong</span><br><span class="line">password mypasswd</span><br><span class="line"><span class="comment"># Set a default account</span></span><br><span class="line">account default : sjtu</span><br><span class="line"><span class="variable">$vim</span> ~/.gitconfig</span><br><span class="line">[sendemail]</span><br><span class="line">    smtpserver = /usr/bin/msmtp</span><br><span class="line"><span class="variable">$vim</span> /etc/proxychain.conf</span><br><span class="line">[ProxyList]</span><br><span class="line">http        127.0.0.1 7890</span><br><span class="line">https       127.0.0.1 7890</span><br><span class="line">socks5 		  127.0.0.1 1080</span><br></pre></td></tr></table></figure><h4 id="3-修改-msmtprc权限"><a href="#3-修改-msmtprc权限" class="headerlink" title="3. 修改~/.msmtprc权限"></a>3. 修改<code>~/.msmtprc</code>权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$chmod</span> 0600 ~/.msmtprc</span><br></pre></td></tr></table></figure><h4 id="4-发送patch-1"><a href="#4-发送patch-1" class="headerlink" title="4. 发送patch"></a>4. 发送patch</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains git send-email -to ffmpeg-devel@ffmpeg.org  0001-avformat-hlsenc-Fix-initial-setting-for-start_pts.patch  </span><br><span class="line">ProxyChains-3.1 (http://proxychains.sf.net)</span><br><span class="line">0001-avformat-hlsenc-Fix-initial-setting-for-start_pts.patch</span><br><span class="line">(mbox) Adding cc: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt; from line <span class="string">'From: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;'</span></span><br><span class="line">(body) Adding cc: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt; from line <span class="string">'Signed-off-by: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;'</span></span><br><span class="line"></span><br><span class="line">From: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">To: ffmpeg-devel@ffmpeg.org</span><br><span class="line">Cc: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">Subject: [PATCH] avformat/hlsenc: Fix initial setting <span class="keyword">for</span> start_pts</span><br><span class="line">Date: Thu,  5 Mar 2020 21:41:52 +0800</span><br><span class="line">Message-Id: &lt;1583415712-6396-1-git-send-email-sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">X-Mailer: git-send-email 2.7.4</span><br><span class="line"></span><br><span class="line">    The Cc list above has been expanded by additional</span><br><span class="line">    addresses found <span class="keyword">in</span> the patch commit message. By default</span><br><span class="line">    send-email prompts before sending whenever this occurs.</span><br><span class="line">    This behavior is controlled by the sendemail.confirm</span><br><span class="line">    configuration setting.</span><br><span class="line"></span><br><span class="line">    For additional information, run <span class="string">'git send-email --help'</span>.</span><br><span class="line">    To retain the current behavior, but squelch this message,</span><br><span class="line">    run <span class="string">'git config --global sendemail.confirm auto'</span>.</span><br><span class="line"></span><br><span class="line">Send this email? ([y]es|[n]o|[q]uit|[a]ll): y  </span><br><span class="line">|DNS-request| smtp.sjtu.edu.cn </span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:7890-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| smtp.sjtu.edu.cn is 202.112.26.54</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:7890-&lt;&gt;&lt;&gt;-202.112.26.54:587-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">OK. Log says:</span><br><span class="line">Sendmail: /usr/bin/msmtp -i ffmpeg-devel@ffmpeg.org sj.hc_Zhong@sjtu.edu.cn</span><br><span class="line">From: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">To: ffmpeg-devel@ffmpeg.org</span><br><span class="line">Cc: Hongcheng Zhong &lt;sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">Subject: [PATCH] avformat/hlsenc: Fix initial setting <span class="keyword">for</span> start_pts</span><br><span class="line">Date: Thu,  5 Mar 2020 21:41:52 +0800</span><br><span class="line">Message-Id: &lt;1583415712-6396-1-git-send-email-sj.hc_Zhong@sjtu.edu.cn&gt;</span><br><span class="line">X-Mailer: git-send-email 2.7.4</span><br><span class="line">Result: OK</span><br></pre></td></tr></table></figure><h2 id="Reply-email-configure-your-email-client"><a href="#Reply-email-configure-your-email-client" class="headerlink" title="Reply email (configure your email client)"></a>Reply email (configure your email client)</h2><ul><li>因为mail list用的是传统的回复风格，找了好久应该怎么配置邮箱客户端</li><li>FFmpeg的FAQ中的<a href="https://ffmpeg.org/mailing-list-faq.html#Rules-and-Etiquette" target="_blank" rel="noopener">Rules-and-Etiquette</a>提到的格式相关：</li></ul><blockquote><ul><li>Avoid <a href="https://en.wikipedia.org/wiki/Posting_style#Top-posting" target="_blank" rel="noopener">top-posting</a>. Also see <a href="https://ffmpeg.org/mailing-list-faq.html#What-is-top_002dposting_003f" target="_blank" rel="noopener">What is top-posting?</a></li><li>Avoid hijacking threads. Thread hijacking is replying to a message and changing the subject line to something unrelated to the original thread. Most email clients will still show the renamed message under the original thread. This can be confusing and these types of messages are often ignored.</li><li>Do not send screenshots. Copy and paste console text instead of making screenshots of the text.</li><li>Avoid sending email disclaimers and legalese if possible as this is a public list.</li><li>If you attach files avoid compressing small files. Uncompressed is preferred.</li><li>Please do not send HTML-only messages. The mailing list will ignore the HTML component of your message. Most mail clients will automatically include a text component: this is what the mailing list will use.</li><li>Configuring your mail client to break lines after 70 or so characters is recommended.</li></ul></blockquote><ul><li>其中提到的”Avoid top-posting”，区分好这个概念很重要，沿着这个找找到了关键<ul><li>sjtu的webmail设置如下：Preferences&gt;Mail&gt;Composing Messages&gt;Email Reply选中Use prefix</li><li>其他设置细节还不清楚</li></ul></li></ul><h2 id="Experience"><a href="#Experience" class="headerlink" title="Experience"></a>Experience</h2><ul><li><p>确保你的修改可以通过FATE测试，<code>make fate</code>会比较慢，可以<code>make fate -j8</code></p></li><li><p>查到有说在<code>.msmtprc</code>里面加<code>proxy_host</code>和<code>proxy_port</code>来走代理的，但是尝试了一下好像没用。</p></li><li><p><code>user</code>字段写完整的邮箱地址或者<code>@</code>前面部分都可以。</p></li><li><p><code>git send-email --smtp-debug=1</code>并不能看到debug信息，也不知道为什么。</p></li><li><p>比较坑的地方是端口：<code>net.sjtu.edu.cn</code>里面说的：</p><blockquote><p>SMTP 发信服务器为 smtp.sjtu.edu.cn， 安全端口为 465；</p></blockquote><p>然而事实上我一开始用465端口死活发不出去，全都死在错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unable to initialize SMTP properly. Check config and use --smtp-debug. VALUES: server=smtp.sjtu.edu.cn encryption=tls hello=localhost.localdomain port=465 at /usr/lib/git-core/git-send-email line 1383.</span><br></pre></td></tr></table></figure><p>后来在<a href="https://wiki.archlinux.org/index.php/Msmtp" target="_blank" rel="noopener">wiki.archlinux.msmtp</a>里面看到了有关的描述，似乎启用TLS的话，应该用587端口，挺坑的。</p></li><li><p>中间试了几次Gmail，发现Google给我发了拦截未知访问的邮件，Google安全做的真好。</p></li><li><p>尝试了msmtp+proxychains，并在修改端口为578后成功发送，后来想着再试试原生的方式，没准只是端口的问题，试了一下，果然是这样！</p></li><li><p>就我尝试的范围内，两种方式的差别有以下：</p><ol><li>原生的方式加的那几条配置挺实用的，还没有在msmtp里面找过</li><li>msmtp要求配置文件改权限为600，因为里面写了明文密码，记得还看到过用别的工具把明文密码加密掉的方式，相对安全一些吧。</li></ol></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><p><a href="https://ffmpeg.org/developer.html" target="_blank" rel="noopener">FFmpeg Developer Documentation</a></p></li><li><p><a href="https://ffmpeg.org/mailing-list-faq.html" target="_blank" rel="noopener">FFmpeg Mailing List FAQ</a></p></li><li><p><a href="https://www.smitechow.com/2018/10/git-send-email-use-proxy.html" target="_blank" rel="noopener">git send-email use proxy (msmtp + proxychains)</a></p></li><li><p><a href="https://wiki.archlinux.org/index.php/Msmtp" target="_blank" rel="noopener">wiki.archlinux.msmtp</a></p></li><li><p><a href="https://www.jianshu.com/p/1f54b144bd5b" target="_blank" rel="noopener">FFmpeg - 修改提交流程, by hwren</a></p></li><li><p><a href="https://wiki.openstack.org/wiki/MailingListEtiquette" target="_blank" rel="noopener">MailingListEtiquette</a></p></li><li><p><a href="https://www.freedesktop.org/wiki/Software/PulseAudio/HowToUseGitSendEmail/" target="_blank" rel="noopener">How to Use git send-email</a></p></li></ul><hr></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>spartazhc</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://spartazhc.github.io/2020/03/06/Submit-Patches-to-FFmpeg/" title="Submit Patches to FFmpeg">https://spartazhc.github.io/2020/03/06/Submit-Patches-to-FFmpeg/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> linux</a> <a href="/tags/tools/" rel="tag"><i class="fa fa-tag"></i> tools</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2019/12/01/Codec-Test/" rel="prev" title="Codec Test"><i class="fa fa-chevron-left"></i> Codec Test</a></div><div class="post-nav-item"><a href="/2020/06/03/Update-hexo-theme-next-to-latest-version-v7-8-0/" rel="next" title="Update hexo-theme-next to latest version(v7.8.0)">Update hexo-theme-next to latest version(v7.8.0) <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-List"><span class="nav-number">1.</span> <span class="nav-text">Check List</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#git-send-email-configuration"><span class="nav-number">2.</span> <span class="nav-text">git send-email configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#default-way"><span class="nav-number">2.1.</span> <span class="nav-text">default way</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-安装软件"><span class="nav-number">2.1.1.</span> <span class="nav-text">1. 安装软件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-配置smtp"><span class="nav-number">2.1.2.</span> <span class="nav-text">2. 配置smtp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-生成patch"><span class="nav-number">2.1.3.</span> <span class="nav-text">3. 生成patch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-发送patch"><span class="nav-number">2.1.4.</span> <span class="nav-text">4. 发送patch</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-msmtp-proxychain"><span class="nav-number">2.2.</span> <span class="nav-text">use msmtp + proxychain</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-安装软件-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">1. 安装软件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-修改配置文件x3"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. 修改配置文件x3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-修改-msmtprc权限"><span class="nav-number">2.2.3.</span> <span class="nav-text">3. 修改~&#x2F;.msmtprc权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-发送patch-1"><span class="nav-number">2.2.4.</span> <span class="nav-text">4. 发送patch</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reply-email-configure-your-email-client"><span class="nav-number">3.</span> <span class="nav-text">Reply email (configure your email client)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Experience"><span class="nav-number">4.</span> <span class="nav-text">Experience</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">5.</span> <span class="nav-text">Reference</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="spartazhc" src="/images/avatar.png"><p class="site-author-name" itemprop="name">spartazhc</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/spartazhc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;spartazhc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="user"></i> </span><span class="author" itemprop="copyrightHolder">spartazhc</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">204k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">3:06</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div><script>(function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"CyVb5GcDokobJWn5jYs0YPHx-gzGzoHsz","app_key":"BPpypYK7M7mcSQVUjgoAcQDs","server_url":"https://cyvb5gcd.lc-cn-n1-shared.com","security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'CyVb5GcDokobJWn5jYs0YPHx-gzGzoHsz',
      appKey     : 'BPpypYK7M7mcSQVUjgoAcQDs',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html><!-- rebuild by neat -->