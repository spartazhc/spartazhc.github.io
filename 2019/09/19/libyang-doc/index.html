<!-- build time:Thu Jun 18 2020 19:18:41 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|EB Garamond:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"spartazhc.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="CESENT公司开源了一套以sysrepo为datastore的网络配置体系。主要有：libyang, sysrepo, libnetconf2, netopeer2，而且libyang和sysrepo是我实现RESTCONF的主要依赖，所以这部分看得比较认真。但是这篇东西基本上就是libyang的doc里面的概述部分。"><meta property="og:type" content="article"><meta property="og:title" content="libyang-doc"><meta property="og:url" content="https://spartazhc.github.io/2019/09/19/libyang-doc/index.html"><meta property="og:site_name" content="spartazhc&#39;s blog"><meta property="og:description" content="CESENT公司开源了一套以sysrepo为datastore的网络配置体系。主要有：libyang, sysrepo, libnetconf2, netopeer2，而且libyang和sysrepo是我实现RESTCONF的主要依赖，所以这部分看得比较认真。但是这篇东西基本上就是libyang的doc里面的概述部分。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-09-19T13:44:38.000Z"><meta property="article:modified_time" content="2019-09-19T13:44:38.000Z"><meta property="article:author" content="spartazhc"><meta property="article:tag" content="restconf"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://spartazhc.github.io/2019/09/19/libyang-doc/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>libyang-doc | spartazhc's blog</title><script>function sendPageView(){if(CONFIG.hostname===location.hostname){var e=localStorage.getItem("uid")||Math.random()+"."+Math.random();localStorage.setItem("uid",e),navigator.sendBeacon("https://www.google-analytics.com/collect",new URLSearchParams({v:1,tid:"UA-168851576-1",cid:e,t:"pageview",dp:encodeURIComponent(location.pathname)}))}}document.addEventListener("pjax:complete",sendPageView),sendPageView()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="spartazhc's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">spartazhc's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a href="https://github.com/spartazhc" class="github-corner" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://spartazhc.github.io/2019/09/19/libyang-doc/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="spartazhc"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="spartazhc's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">libyang-doc</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-19 21:44:38" itemprop="dateCreated datePublished" datetime="2019-09-19T21:44:38+08:00">2019-09-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/restconf/" itemprop="url" rel="index"><span itemprop="name">restconf</span></a> </span></span><span id="/2019/09/19/libyang-doc/" class="post-meta-item leancloud_visitors" data-flag-title="libyang-doc" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2019/09/19/libyang-doc/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2019/09/19/libyang-doc/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>8.9k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><div class="note default"><p>CESENT公司开源了一套以sysrepo为datastore的网络配置体系。主要有：<code>libyang</code>, <code>sysrepo</code>, <code>libnetconf2</code>, <code>netopeer2</code>，而且<code>libyang</code>和<code>sysrepo</code>是我实现RESTCONF的主要依赖，所以这部分看得比较认真。</p><p>但是这篇东西基本上就是<code>libyang</code>的doc里面的概述部分。</p></div><a id="more"></a><h2 id="libyang"><a href="#libyang" class="headerlink" title="libyang"></a>libyang</h2><p><strong>Context - Schema - Data</strong></p><ul><li><p>difference between <em>imported</em> and <em>implemented</em>?</p></li><li><p>functions for schemas have <strong>lys_</strong> prefix while functions for instance data have <strong>lyd_</strong> prefix</p></li></ul><h2 id="YANG"><a href="#YANG" class="headerlink" title="YANG"></a>YANG</h2><ul><li>A <strong>container</strong> node does not have a value, but it has a list of child nodes in the data tree.</li></ul><h2 id="Questions"><a href="#Questions" class="headerlink" title="Questions:"></a>Questions:</h2><ul><li>yang定义的rpc和实现过程中的rpc有什么关系？<ul><li>A: rfc8040里面讲的意思好像是yang里面定义的”rpc”. “action”通过http POST去触发</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rpc</span> <span class="attr">message-id</span>=<span class="string">"101"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"urn:ietf:params:xml:ns:netconf:base:1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activate-software-image</span> <span class="attr">xmlns</span>=<span class="string">"http://example.com/system"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image-name</span>&gt;</span>example-fw-2.3<span class="tag">&lt;/<span class="name">image-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activate-software-image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rpc</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rpc-reply</span> <span class="attr">message-id</span>=<span class="string">"101"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"urn:ietf:params:xml:ns:netconf:base:1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">status</span> <span class="attr">xmlns</span>=<span class="string">"http://example.com/system"</span>&gt;</span></span><br><span class="line">    The image example-fw-2.3 is being installed.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">status</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rpc-reply</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>头部的namespace是怎么写的，是多一点操作就要多加一条相关的吗？</li><li>下面这条rpc， <code>&lt;config&gt;</code>里面的写法还不懂</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rpc</span> <span class="attr">message-id</span>=<span class="string">"101"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"urn:ietf:params:xml:ns:netconf:base:1.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:nc</span>=<span class="string">"urn:ietf:params:xml:ns:netconf:base:1.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:yang</span>=<span class="string">"urn:ietf:params:xml:ns:yang:1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">edit-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">running</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">system</span> <span class="attr">xmlns</span>=<span class="string">"urn:example:config"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">xmlns:ex</span>=<span class="string">"urn:example:config"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">user</span> <span class="attr">nc:operation</span>=<span class="string">"create"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">yang:insert</span>=<span class="string">"after"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">yang:key</span>=<span class="string">"[ex:first-name=’fred’]</span></span></span><br><span class="line"><span class="tag"><span class="string">                                [ex:surname=’flintstone’]"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">first-name</span>&gt;</span>barney<span class="tag">&lt;/<span class="name">first-name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">surname</span>&gt;</span>rubble<span class="tag">&lt;/<span class="name">surname</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">type</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">edit-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rpc</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>为什么ietf-restconf.yang里面只定义了group</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The &quot;ietf-restconf&quot; module defines conceptual definitions within an</span><br><span class="line">extension and two groupings, which are not meant to be implemented as</span><br><span class="line">datastore contents by a server. For example, the &quot;restconf&quot;</span><br><span class="line">container is not intended to be implemented as a top-level data node</span><br><span class="line">(under the &quot;&#x2F;restconf&#x2F;data&quot; URI).</span><br></pre></td></tr></table></figure><h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p><strong>ly_ctx_*</strong></p><ul><li><p>The context concept allows callers to work in environments with different sets of YANG schemas.</p></li><li><p>Context holds all modules and their submodules internally.</p></li><li><p>To get a specific module or submodule, use <a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#gaf9cd151a6f7cb5246ea34f6681b4e0c2" target="_blank" rel="noopener">ly_ctx_get_module()</a> and <a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#ga4e95dad7cc374046b84352eddff3a420" target="_blank" rel="noopener">ly_ctx_get_submodule()</a>.</p></li><li><p>If you need to do something with all the modules or submodules in the context, it is advised to iterate over them using <a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#ga8ad57a5482f3c57c099bfd32a17e6f47" target="_blank" rel="noopener">ly_ctx_get_module_iter()</a>, it is the most efficient way.</p></li><li><p>Alternatively, the <a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#ga3189ba8857eee441f9f413a8abee0ae5" target="_blank" rel="noopener">ly_ctx_info()</a> function can be used to get complex information about the schemas in the context in the form of data tree defined by <a href="https://tools.ietf.org/html/draft-ietf-netconf-yang-library-04" target="_blank" rel="noopener">ietf-yang-library</a> schema.</p></li><li><p>To get a specific node defined in a module in the context, <a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#gaff344e9b687a734352f51b21fa71782f" target="_blank" rel="noopener">ly_ctx_find_path()</a> or <a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#gabce6ff4f82d0ce7786d0a89cb70fb369" target="_blank" rel="noopener">ly_ctx_get_node()</a> can be used.</p></li></ul><h2 id="Schemas"><a href="#Schemas" class="headerlink" title="Schemas"></a>Schemas</h2><p><strong>lys_features_*</strong></p><p><strong>lys_parse_*</strong></p><p>Schema is an internal libyang’s representation of a YANG data model. Each schema is connected with its <a href="https://netopeer.liberouter.org/doc/libyang/master/howtocontext.html" target="_blank" rel="noopener">context</a> and loaded using <a href="https://netopeer.liberouter.org/doc/libyang/master/howtoschemasparsers.html" target="_blank" rel="noopener">parser functions</a>. It means, that the schema cannot be created (nor changed) programmatically. In libyang, schemas are used only to access data model definitions.</p><ul><li><p>Basic YANG schemas format described in <a href="http://tools.ietf.org/html/rfc6020" target="_blank" rel="noopener">RFC 6020</a> and <a href="http://tools.ietf.org/html/rfc7951" target="_blank" rel="noopener">RFC 7951</a> (so both YANG 1.0 and YANG 1.1 versions are supported).</p></li><li><p>When the <a href="https://netopeer.liberouter.org/doc/libyang/master/howtocontext.html" target="_blank" rel="noopener">context</a> is created, it already contains the following schemas, which are implemented internally by libyang:</p><ul><li>ietf-yang-metadata@2016-08-05</li><li>yang@2017-02-20</li><li>ietf-inet-types@2013-07-15</li><li>ietf-yang-types@2013-07-15</li><li>ietf-yang-library@2016-06-21</li></ul></li><li><p>The <code>yang</code> schema is the libyang’s internal module to provide namespace and definitions of for various YANG attributes described in <a href="https://tools.ietf.org/html/rfc6243" target="_blank" rel="noopener">RFC 7951</a> (such as <code>insert</code> attribute for edit-config’s data).</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lys_node</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name;                <span class="comment">/**&lt; node name (mandatory) */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *dsc;                 <span class="comment">/**&lt; description statement (optional) */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *ref;                 <span class="comment">/**&lt; reference statement (optional) */</span></span><br><span class="line">    <span class="keyword">uint16_t</span> flags;                  <span class="comment">/**&lt; [schema node flags](@ref snodeflags) */</span></span><br><span class="line">    <span class="keyword">uint8_t</span> ext_size;                <span class="comment">/**&lt; number of elements in #ext array */</span></span><br><span class="line">    <span class="keyword">uint8_t</span> iffeature_size;          <span class="comment">/**&lt; number of elements in the #iffeature array */</span></span><br><span class="line">    <span class="keyword">uint8_t</span> padding[<span class="number">4</span>];              </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_ext_instance</span> **<span class="title">ext</span>;</span>   <span class="comment">/**&lt; array of pointers to the extension instances */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_iffeature</span> *<span class="title">iffeature</span>;</span> <span class="comment">/**&lt; array of if-feature expressions */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_module</span> *<span class="title">module</span>;</span>       <span class="comment">/**&lt; pointer to the node's module (mandatory) */</span></span><br><span class="line">    LYS_NODE nodetype;               <span class="comment">/**&lt; type of the node (mandatory) */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_node</span> *<span class="title">parent</span>;</span>         <span class="comment">/**&lt; pointer to the parent node, NULL in case of a top level node */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_node</span> *<span class="title">child</span>;</span>          </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_node</span> *<span class="title">next</span>;</span>           <span class="comment">/**&lt; pointer to the next sibling node (NULL if there is no one) */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">lys_node</span> *<span class="title">prev</span>;</span>           </span><br><span class="line">    <span class="keyword">void</span> *priv;                      <span class="comment">/**&lt; private caller's data, not used by libyang */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Data-Instances"><a href="#Data-Instances" class="headerlink" title="Data Instances"></a>Data Instances</h2><p>All data nodes in data trees are connected with their schema node - libyang is not able to represent data of an unknown schema.</p><h3 id="Parsing-data"><a href="#Parsing-data" class="headerlink" title="Parsing data"></a>Parsing data</h3><ul><li><strong>lyd_parse_*</strong></li></ul><h3 id="Manipulating-Data"><a href="#Manipulating-Data" class="headerlink" title="Manipulating Data"></a>Manipulating Data</h3><p>Creating data is generally possible in two ways, they can be combined.</p><ul><li>You can add nodes one-by-one based on the node name and/or its parent (<a href="https://netopeer.liberouter.org/doc/libyang/master/group__datatree.html#ga84863d0360258e3bc4930d598658094b" target="_blank" rel="noopener">lyd_new()</a>, <strong>lyd_new_anydata_*</strong>(), <a href="https://netopeer.liberouter.org/doc/libyang/master/group__datatree.html#ga8cc511af9ca3b3a7048c3a5f6fe8f0db" target="_blank" rel="noopener">lyd_new_leaf()</a>, and their output variants)</li><li>or address the nodes using a simple XPath addressing (<a href="https://netopeer.liberouter.org/doc/libyang/master/group__datatree.html#ga31b3de84e33ece1022738f15fcac4242" target="_blank" rel="noopener">lyd_new_path()</a>).</li><li>The latter enables to create a whole path of nodes, requires less information about the modified data, and is generally simpler to use. The path format specifics can be found <a href="https://netopeer.liberouter.org/doc/libyang/master/howtoxpath.html" target="_blank" rel="noopener">here</a>.</li></ul><p>Working with two data subtrees can also be performed two ways.</p><ul><li>Usually, you would use lyd_insert*() functions. They are generally meant for simple inserts of a node into a data tree.</li><li>For more complicated inserts and when merging 2 trees use <a href="https://netopeer.liberouter.org/doc/libyang/master/group__datatree.html#gad1664b6cac7b4af0cfad588c682c9c3b" target="_blank" rel="noopener">lyd_merge()</a>. It offers additional options and is basically a more powerful insert.</li></ul><h3 id="Validating-Data"><a href="#Validating-Data" class="headerlink" title="Validating Data"></a>Validating Data</h3><ul><li><strong>lyd_validate()</strong></li></ul><h3 id="Default-Values"><a href="#Default-Values" class="headerlink" title="Default Values"></a>Default Values</h3><p>libyang provides support for work with default values as defined in <a href="https://tools.ietf.org/html/rfc6243" target="_blank" rel="noopener">RFC 6243</a>. This document defines 4 modes for handling default nodes in a data tree, libyang adds the fifth mode:</p><ul><li><strong>explicit</strong> - Only the explicitly set configuration data. But in the case of status data, missing default data are added into the tree. In libyang, this mode is represented by <a href="https://netopeer.liberouter.org/doc/libyang/master/group__printerflags.html#ga7c1600afee107c9a10571565c1c359cc" target="_blank" rel="noopener">LYP_WD_EXPLICIT</a> option.</li><li><strong>trim</strong> - Data nodes containing the schema default value are removed. This mode is applied using <a href="https://netopeer.liberouter.org/doc/libyang/master/group__printerflags.html#gadf3263351807e4a7b0274c06310c691a" target="_blank" rel="noopener">LYP_WD_TRIM</a> option.</li><li><strong>report-all</strong> - All the missing default data are added into the data tree. This mode is represented by <a href="https://netopeer.liberouter.org/doc/libyang/master/group__printerflags.html#ga917bb092a127506bb61ef6fc044724de" target="_blank" rel="noopener">LYP_WD_ALL</a> option.</li><li><strong>report-all-tagged</strong> - In this case, all the missing default data are added as in case of the <code>report-all</code> mode, but additionally all the nodes (existing as well as added) containing the schema default value are tagged (see the note below). libyang uses <a href="https://netopeer.liberouter.org/doc/libyang/master/group__printerflags.html#gaf242c90016e3e1dc3e039206f6536786" target="_blank" rel="noopener">LYP_WD_ALL_TAG</a> option for this mode.</li><li><strong>report-implicit-tagged</strong> - The last mode is similar to the previous one, except only the added nodes are tagged. This is the libyang’s extension and it is represented by <a href="https://netopeer.liberouter.org/doc/libyang/master/group__printerflags.html#ga93fa4001f5d73d942ca4cb80c28edeed" target="_blank" rel="noopener">LYP_WD_IMPL_TAG</a> option.</li></ul><h2 id="XPath-Addressing"><a href="#XPath-Addressing" class="headerlink" title="XPath Addressing"></a>XPath Addressing</h2><h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><p>Regarding identifying schema nodes, we use a slightly modified version of YANG <strong>augment</strong> target path:</p><ul><li>strictly speaking, most XPath expressions are not accepted, only simple paths (no predicates, numbers, literals, operators, …),</li><li>whenever a prefix is used for a node, it is not the import prefix, but the <strong>module name</strong> itself,</li><li><strong>current module</strong> is specified separately for <em>absolute</em> paths and is the module of the start (current) node for <em>relative</em> paths,</li><li>unprefixed nodes all use the prefix of the <strong>current module</strong> so all nodes from other modules than the <strong>current module</strong> <em>MUST</em> have prefixes,</li><li>nodes from the <strong>current module</strong> <em>MAY</em> have prefixes,</li></ul><h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><ul><li><p>get all top-level nodes of the <strong>module-name</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;module-name:*</span><br></pre></td></tr></table></figure></li><li><p>get all the descendants of <strong>container</strong> (excluding container)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;module-name:container&#x2F;&#x2F;*</span><br></pre></td></tr></table></figure></li><li><p>get <strong>aug-leaf</strong>, which was added to <strong>module-name</strong> from an augment module <strong>augment-module</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;module-name:container&#x2F;container2&#x2F;augment-module:aug-cont&#x2F;augment-module:aug-leaf</span><br></pre></td></tr></table></figure></li></ul><h4 id="Functions-List"><a href="#Functions-List" class="headerlink" title="Functions List"></a>Functions List</h4><ul><li><a href="https://netopeer.liberouter.org/doc/libyang/master/group__schematree.html#ga4039ced8497a02779ac05c3fee0ad66b" target="_blank" rel="noopener">lys_find_path()</a></li><li><a href="https://netopeer.liberouter.org/doc/libyang/master/group__schematree.html#ga8e5b98c5ef4b5c182485c8d6e3ff3e24" target="_blank" rel="noopener">lys_path()</a></li><li><a href="https://netopeer.liberouter.org/doc/libyang/master/group__context.html#ga30d5e7b3071b6528f5f3b4b20f8225ba" target="_blank" rel="noopener">ly_path_data2schema()</a></li></ul><h3 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h3><p>As for paths evaluated on YANG data, we opted for standardized JSON paths (<a href="https://tools.ietf.org/html/rfc7951#section-6.11" target="_blank" rel="noopener">RFC 7951</a>). Summarized, it follows these conventions:</p><ul><li>generally, you can use almost a full XPath in these paths where it makes sense, but only data nodes (node sets) will always be returned (except for paths, predicates are mostly used),</li><li>as per the specification, prefixes are actually <strong>module names</strong>,</li><li>also in the specification, for <em>absolute</em> paths, the first (leftmost) node <em>MUST</em> have a prefix,</li><li>for <em>relative</em> paths, you specify the <strong>context node</strong>, which then acts as a parent for the first node in the path,</li><li>nodes always inherit their module (prefix) from their <strong>parent node</strong> so whenever a node is from a different module than its parent, it <em>MUST</em> have a prefix,</li><li>nodes from the same module as their <strong>parent</strong> <em>MUST NOT</em> have a prefix,</li><li>different from schema paths, non-data nodes (choice, case, uses, input, output) are skipped and not included in the path.</li></ul><h4 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples"></a>Examples</h4><ul><li><p>get <strong>list</strong> instance with <strong>key1</strong> of value <strong>1</strong> and <strong>key2</strong> of value <strong>2</strong> (this can return more <strong>list</strong> instances if there are more keys than <strong>key1</strong> and <strong>key2</strong>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;module-name:container&#x2F;list[key1&#x3D;&#39;1&#39;][key2&#x3D;&#39;2&#39;]</span><br></pre></td></tr></table></figure></li><li><p>get <strong>leaf-list</strong> instance with the value <strong>val</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;module-name:container&#x2F;leaf-list[.&#x3D;&#39;val&#39;]</span><br></pre></td></tr></table></figure></li><li><p>get <strong>aug-list</strong> with <strong>aug-list-key</strong>, which was added to <strong>module-name</strong> from an augment module <strong>augment-module</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;module-name:container&#x2F;container2&#x2F;augment-module:aug-cont&#x2F;aug-list[aug-list-key&#x3D;&#39;value&#39;]</span><br></pre></td></tr></table></figure></li></ul><h4 id="Functions-List-1"><a href="#Functions-List-1" class="headerlink" title="Functions List"></a>Functions List</h4><h2 id="TEST"><a href="#TEST" class="headerlink" title="TEST"></a>TEST</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># need to kill sysrepod</span></span><br><span class="line">sudo sysrepoctl --uninstall --module=building</span><br><span class="line">sudo sysrepoctl --install --yang=./building@2019-08-07.yang --owner=root:root --permissions=666</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># yang define</span><br><span class="line"># 这个building是我当时测试多级container的yang，是看一个国外老哥的视频写的，也是yang入门了</span><br><span class="line">#（但是我用的是加了一些东西的下一个version）</span><br><span class="line">module building &#123;</span><br><span class="line">  yang-version 1;</span><br><span class="line">  namespace "urn:building:test";</span><br><span class="line"></span><br><span class="line">  prefix bld;</span><br><span class="line"></span><br><span class="line">  organization "building";</span><br><span class="line">  contact "building address";</span><br><span class="line">  description "yang model for buildings";</span><br><span class="line">  revision "2019-08-07" &#123;</span><br><span class="line">    description "modified revision";</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  container rooms &#123;</span><br><span class="line">    list room &#123;</span><br><span class="line">      key "room-number room-name";</span><br><span class="line">      leaf room-number &#123;</span><br><span class="line">        type uint16;</span><br><span class="line">      &#125;</span><br><span class="line">      leaf room-name &#123;</span><br><span class="line">        type string;</span><br><span class="line">      &#125;</span><br><span class="line">      leaf size &#123;</span><br><span class="line">        type uint32;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>spartazhc</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://spartazhc.github.io/2019/09/19/libyang-doc/" title="libyang-doc">https://spartazhc.github.io/2019/09/19/libyang-doc/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/restconf/" rel="tag"><i class="fa fa-tag"></i> restconf</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2019/09/19/clixon-backend-restconf/" rel="prev" title="clixon_backend_restconf"><i class="fa fa-chevron-left"></i> clixon_backend_restconf</a></div><div class="post-nav-item"><a href="/2019/09/19/Netopeer2/" rel="next" title="Netopeer2">Netopeer2 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#libyang"><span class="nav-number">1.</span> <span class="nav-text">libyang</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#YANG"><span class="nav-number">2.</span> <span class="nav-text">YANG</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Questions"><span class="nav-number">3.</span> <span class="nav-text">Questions:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Context"><span class="nav-number">4.</span> <span class="nav-text">Context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Schemas"><span class="nav-number">5.</span> <span class="nav-text">Schemas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Instances"><span class="nav-number">6.</span> <span class="nav-text">Data Instances</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Parsing-data"><span class="nav-number">6.1.</span> <span class="nav-text">Parsing data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manipulating-Data"><span class="nav-number">6.2.</span> <span class="nav-text">Manipulating Data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Validating-Data"><span class="nav-number">6.3.</span> <span class="nav-text">Validating Data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Default-Values"><span class="nav-number">6.4.</span> <span class="nav-text">Default Values</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XPath-Addressing"><span class="nav-number">7.</span> <span class="nav-text">XPath Addressing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Schema"><span class="nav-number">7.1.</span> <span class="nav-text">Schema</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Examples"><span class="nav-number">7.1.1.</span> <span class="nav-text">Examples</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Functions-List"><span class="nav-number">7.1.2.</span> <span class="nav-text">Functions List</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data"><span class="nav-number">7.2.</span> <span class="nav-text">Data</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Examples-1"><span class="nav-number">7.2.1.</span> <span class="nav-text">Examples</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Functions-List-1"><span class="nav-number">7.2.2.</span> <span class="nav-text">Functions List</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TEST"><span class="nav-number">8.</span> <span class="nav-text">TEST</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="spartazhc" src="/images/avatar.png"><p class="site-author-name" itemprop="name">spartazhc</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">28</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">14</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/spartazhc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;spartazhc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="user"></i> </span><span class="author" itemprop="copyrightHolder">spartazhc</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">180k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:44</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div><script>(function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"CyVb5GcDokobJWn5jYs0YPHx-gzGzoHsz","app_key":"BPpypYK7M7mcSQVUjgoAcQDs","server_url":"https://cyvb5gcd.lc-cn-n1-shared.com","security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'CyVb5GcDokobJWn5jYs0YPHx-gzGzoHsz',
      appKey     : 'BPpypYK7M7mcSQVUjgoAcQDs',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html><!-- rebuild by neat -->